name: Run Unit Tests - All Tasks

on:
  push:
    branches: [ main, task-1, task-2, task-3 ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # Install base requirements
        pip install -r requirements.txt
        # Install Task 2 specific dependencies
        pip install -r requirements_task2.txt
        # Install Task 3 specific dependencies  
        pip install -r requirements_task3.txt
    
    - name: Test data files exist
      run: |
        if [ -f "data/raw_analyst_ratings.csv" ]; then
          echo "Data file exists"
        else
          echo " Data file missing"
          exit 1
        fi
    
    - name: Run Task 1 tests
      run: |
        python -m pytest tests/test_data.py -v
    
    - name: Run Task 2 tests  
      run: |
        python tests/test_task2.py
    
    - name: Run Task 3 tests
      run: |
        python tests/test_task3.py
    
    - name: Verify notebook structure
      run: |
        echo " Checking notebook structure..."
        ls -la notebooks/
        echo " Notebook structure verified"